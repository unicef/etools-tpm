<!--import [polymer, etools-ajax, etools-app-config, lodash]-->

<dom-module id="update-staff-members">

    <template>

        <etools-ajax method="{{method}}"
                     url="{{url}}"
                     body="{{postData}}"
                     on-success="_handleResponse"
                     on-fail="_handleError"></etools-ajax>

    </template>

    <script>

        Polymer({

            is: 'update-staff-members',

            behaviors: [
                etoolsAppConfig.globals
            ],

            properties: {
                vendorNumber: String,
                staffData: {
                    type: Object,
                    notify: true,
                    observer: '_dataChanged'
                }
            },

            _dataChanged: function(data) {
                if (!data) { return; }
                if (!this.vendorNumber) { throw 'Vendor number is not provided!'; }
                if (!data.method || !data.data) { throw 'Method or data are missing!'}

                this.lastRequestData = _.cloneDeep(data);

                this.method = data.method;
                this.url = this.getEndpoint('partnerDetails', {id: this.vendorNumber}).url + data.id;
                this.postData = data;
                this.set('staffData', null);
            },

            _handleResponse: function(event, detail) {
                this.fire('staff-updated', {action: this.lastRequestData.method.toLowerCase(), data: detail, index: this.lastRequestData.staffIndex});
            },

            _handleError: function(event, error) {
                let responseData = error && error.request && error.request.detail &&
                        error.request.detail.request && error.request.detail.request.xhr;

                let {status, response} = responseData || {};

                this.fire('staff-updated', {error: true, errorData: response, status: status});
            }

        });

    </script>

</dom-module>
